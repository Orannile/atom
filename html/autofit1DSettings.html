
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>autofit1DSettings</title><meta name="generator" content="MATLAB 9.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-02-26"><meta name="DC.source" content="autofit1DSettings.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Sample filename %%%%%%%%%</a></li><li><a href="#3">Background filename %%%%%</a></li><li><a href="#4">Edit these values and inspect the background subtracted curve %%%%%%%</a></li><li><a href="#5">Initial values %%%%%%%%%%</a></li><li><a href="#6">2Theta settings %%%%%%%%%</a></li><li><a href="#7">Fit range</a></li><li><a href="#8">The interlayer counter-ion</a></li><li><a href="#9">Change G-factor number... 1 &amp; 2 are the silicate layer, 3, 4, 5 are the</a></li><li><a href="#10">G's corresponding to the lower to higher basal spacings, like 0W, 1W, 2W or 1W, 2W, 3W etc.</a></li><li><a href="#11">Optimize these atom types</a></li><li><a href="#12">Change G-factor with these fractions (* or /)</a></li><li><a href="#13">1      2     3  ...</a></li><li><a href="#14">To repeat the above values... in case of fitting many Atom types</a></li><li><a href="#15">Set basal spacings W0 W1 W2 W3 W4 and so on...</a></li><li><a href="#16">Gtransform_files %%%%%%%%</a></li><li><a href="#17">To run with Calcium MD data (you need to generate new G2's from WyCa</a></li><li><a href="#18">Default values for G2</a></li><li><a href="#19">Custom variables</a></li><li><a href="#21">Do the background subtraction</a></li><li><a href="#23">Import chamber background</a></li><li><a href="#24">Import chamber background</a></li><li><a href="#25">Import sample data</a></li><li><a href="#26">Plot the data</a></li><li><a href="#27">Remove background</a></li></ul></div><pre class="codeinput">format <span class="string">compact</span>;
</pre><h2 id="2">Sample filename %%%%%%%%%</h2><pre class="codeinput">filename=<span class="string">'Swy-2_3_60_FDS_1_16_glycol_manual_new.xrdml'</span>;
</pre><h2 id="3">Background filename %%%%%</h2><pre class="codeinput">Backgroundfile1=<span class="string">'CECslideglass.xrdml'</span>;
Backgroundfile2=<span class="string">'MMT_hk.xrdml'</span>;
<span class="comment">% Backgroundfile='Chamber_background_thin_kapton_foil_halftime.xrdml';</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</pre><h2 id="4">Edit these values and inspect the background subtracted curve %%%%%%%</h2><p>main_background_peak=5.52; % Should be around 6.3 2theta for PSU</p><pre class="codeinput">subtract_background=1;
bckgrnd_factor1=0; <span class="comment">% Should be around 0.1 - 0.3</span>
bckgrnd_factor2=0; <span class="comment">%</span>
bckgrnd_windowsize=5; <span class="comment">% Try 3-5, see Matlabs msbackadj()</span>
bckgrnd_stepsize=4; <span class="comment">% Try 2-4 see Matlabs msbackadj()</span>
bckgrnd_start=13; <span class="comment">% Try 8-12, no background subtraction below this value</span>
align_angle=26.18;
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
HIGHN=30; <span class="comment">% Max number of layers per stack, Will affect speed</span>
</pre><h2 id="5">Initial values %%%%%%%%%%</h2><pre class="codeinput">MaxIter=5; <span class="comment">% lsqnonlin iterations</span>
</pre><h2 id="6">2Theta settings %%%%%%%%%</h2><pre class="codeinput">lambda=1.541837;
anglestart=2; <span class="comment">% Default 2</span>
angleend=60; <span class="comment">% Default 45</span>
anglestep = 0.05; <span class="comment">% Default 0.05</span>
exp_angleend=60; <span class="comment">% Default 45 or 50</span>
exp_anglestep=0.0334; <span class="comment">% Default 0.334</span>
</pre><h2 id="7">Fit range</h2><pre class="codeinput">fitstart=3.5; fitend=60;<span class="comment">% Range for the residual in lsqnonlin</span>
normstart=3;normend=11;<span class="comment">% where will we find the 001 reflection for normalization</span>
<span class="comment">% exclude=[19.2 24   34 39 52 60]; % Exclude fitting between these values due to the hk0 reflections</span>
exclude=[12 14 50 60]; <span class="comment">% Exclude fitting between these values due to the hk0 reflections</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</pre><h2 id="8">The interlayer counter-ion</h2><p>counterion='Na'; ncounterion=0.66; % Used? per unit cell</p><h2 id="9">Change G-factor number... 1 &amp; 2 are the silicate layer, 3, 4, 5 are the</h2><h2 id="10">G's corresponding to the lower to higher basal spacings, like 0W, 1W, 2W or 1W, 2W, 3W etc.</h2><pre class="codeinput">ff=<span class="string">'opls'</span>
homogenous=0;
G_id=[4]; <span class="comment">% 1,2 equals the silicate layers 3,4,5 stands for component 1,2 and 3</span>
</pre><h2 id="11">Optimize these atom types</h2><pre class="codeinput">Atom_labels_SIL=[];<span class="comment">%{'Si' 'Obasal' 'Oapical' 'Oh' 'H'}; % Clay</span>
<span class="comment">% % Atom_labels_IL={'Cc1' 'Oc1' 'Hc1' 'Cc2' 'Oc2' 'Hc2'}; % Ow implicitly includes Hw</span>
Atom_labels_IL={<span class="string">'Cc'</span> <span class="string">'Oc'</span>};<span class="comment">% 'Hc' 'Ca' 'Ow'}; % Ow implicitly includes Hw</span>
Atom_labels=[Atom_labels_SIL Atom_labels_IL];<span class="comment">% unique([structures.type])'; % all</span>
</pre><h2 id="12">Change G-factor with these fractions (* or /)</h2><p>%%    P  Z_shift  B Gmod=[1  0  1];</p><h2 id="13">1      2     3  ...</h2><p>%%    P      Z     B      [*      +-    *  ]; %repmat(Gmod./Gmod,1,numel(Atom_labels)) ];</p><pre class="codeinput">x0G2_SIL = [1.0   0.00  1   ]; <span class="comment">%repmat(Gmod./Gmod,1,numel(Atom_labels)) ];</span>
lbG2_SIL = [1.0  -0.10  1   ];
ubG2_SIL = [1.0   0.10  1   ];
x0G2_IL  = [1.0   0.00  1   ]; <span class="comment">%repmat(Gmod./Gmod,1,numel(Atom_labels)) ];</span>
lbG2_IL  = [0.8  -0.20  1   ];
ubG2_IL  = [1.2   0.20  1   ];
</pre><h2 id="14">To repeat the above values... in case of fitting many Atom types</h2><pre class="codeinput">x0G2=[repmat(x0G2_SIL,1,numel(Atom_labels_SIL)) repmat(x0G2_IL,1,numel(Atom_labels_IL))];
lbG2=[repmat(lbG2_SIL,1,numel(Atom_labels_SIL)) repmat(lbG2_IL,1,numel(Atom_labels_IL))];
ubG2=[repmat(ubG2_SIL,1,numel(Atom_labels_SIL)) repmat(ubG2_IL,1,numel(Atom_labels_IL))];
<span class="comment">% x0G2=[repmat(x0G2_IL,1,numel(Atom_labels_IL))];</span>
<span class="comment">% lbG2=[repmat(lbG2_IL,1,numel(Atom_labels_IL))];</span>
<span class="comment">% ubG2=[repmat(ubG2_IL,1,numel(Atom_labels_IL))];</span>
<span class="comment">% x0G2=x0G2_IL;</span>
<span class="comment">% lbG2=lbG2_IL;</span>
<span class="comment">% ubG2=ubG2_IL;</span>
</pre><h2 id="15">Set basal spacings W0 W1 W2 W3 W4 and so on...</h2><pre class="codeinput">d001_0=13.9; <span class="comment">% 0W % 10.9 for Cs...</span>
d001_1=17; <span class="comment">% 05W</span>
d001_2=22; <span class="comment">% 1W</span>
d001_3=22; <span class="comment">% 2W</span>
d001_4=22; <span class="comment">% 3W</span>
d001_5=40; <span class="comment">% 4W</span>
deltaD=.2;
</pre><h2 id="16">Gtransform_files %%%%%%%%</h2><p>lattice='Swy-2'; % Default 'Swy-2' lattice type interlayername='MX80'; % The interlayer type names Gtransform_files={strcat('G2_',lattice,'.mat') strcat('G2_',lattice,'.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_0W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_1W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_2W.mat')...     strcat('G2_',counterion,'_',lattice,'_',interlayername,'_3W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_4W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_10W.mat')}; 1W     strcat('../../G2_from_MD/WyCa_prevNa/G2md_swy-2_evap_222.mat')... strcat('../../G2_from_MD/WyCa/G2md_swy-2_evap_233.mat')...</p><pre class="codeinput">Gtransform_files={<span class="keyword">...</span>
    strcat(<span class="string">'G2_scripts/G2_Swy-2_2-60.mat'</span>)<span class="keyword">...</span>
    strcat(<span class="string">'G2_scripts/G2_Swy-2_2-60.mat'</span>)<span class="keyword">...</span>
    strcat(<span class="string">'G2_scripts/G2md_Swy-2_'</span>,ff,<span class="string">'_1H2O_55.mat'</span>)<span class="keyword">...</span>
    strcat(<span class="string">'G2_scripts/G2md_Swy-2_'</span>,ff,<span class="string">'_1H2O_46.mat'</span>)<span class="keyword">...</span>
    strcat(<span class="string">'G2_scripts/G2md_Swy-2_opls_4H2O_39.mat'</span>)<span class="keyword">...</span>
    strcat(<span class="string">'G2_scripts/G2_Swy-2_glycol_Rey_16.9.mat'</span>)<span class="keyword">...</span>
    strcat(<span class="string">'../G2_from_MD/OPLS/16_CTA/G2md_Swy-2_opls_79.mat'</span>)<span class="keyword">...</span>
    strcat(<span class="string">'G2_scripts/G2_Swy-2_2-60.mat'</span>)<span class="keyword">...</span>
    };
<span class="comment">%    strcat('../G2_from_MD/OPLS/16_CTA/G2md_Swy-2_opls_79.mat')...</span>
<span class="comment">%    strcat('../G2_from_MD/OPLS/16_CTA/G2md_Swy-2_opls_79.mat')...</span>
<span class="comment">% strcat('../G2_from_MD/OPLS/4_CTA/G2md_Swy-2_opls_79.mat')...</span>
<span class="comment">%    strcat('../G2_from_MD/WyCa/G2md_swy-2_evap_179.mat')...</span>
<span class="comment">%    strcat('../G2_from_MD/WyCa/G2md_swy-2_evap_160.mat')...</span>
<span class="comment">%    strcat('../G2_from_MD/WyCa/G2md_swy-2_evap_140.mat')};</span>
<span class="comment">%    strcat('../../G2_from_MD/WyCa/G2_Swy-2_3W_FDb.mat')...</span>
<span class="comment">%    strcat('../G2_from_MD/G2md_swy-2_1W.mat')...</span>
<span class="comment">%     strcat('../G2_from_MD/G2_Swy-2_2-60.mat')...</span>
<span class="comment">%     strcat('../G2_from_MD/G2_Swy-2_2-60.mat')...</span>
<span class="comment">%     strcat('../G2_from_MD/G2_Swy-2_2-60.mat')...</span>
<span class="comment">% strcat('../G2_from_MD/OPLS/4_CTA/G2md_Swy-2_opls_79.mat')...</span>
<span class="comment">% strcat('../G2_from_MD/OPLS/4_CTA/G2md_Swy-2_opls_79.mat')...</span>
<span class="comment">%</span>

<span class="comment">%strcat('../G2_from_MD/OPLS/8_CTA/G2md_Swy-2_opls_80.mat')...</span>
</pre><h2 id="17">To run with Calcium MD data (you need to generate new G2's from WyCa</h2><p>predicted_d001=12.4; md_d001=load('d001.dat'); md_d001(:,2)=10*md_d001(:,2); [~, ind_md_d001] = min(abs(md_d001(:,2)-predicted_d001)); md_d001(ind_md_d001,1)</p><h2 id="18">Default values for G2</h2><pre class="codeinput">P=1;
Z_shift=0;
B=1;
</pre><h2 id="19">Custom variables</h2><pre class="codeinput">custom1=0; <span class="comment">%</span>
custom2=0; <span class="comment">%</span>
custom3=0; <span class="comment">%</span>
lb_custom1=0;
lb_custom2=0;
lb_custom3=0;
ub_custom1=0;
ub_custom2=2;
ub_custom3=0;

<span class="comment">%%%%%%%%%%%%</span>
</pre><h2 id="21">Do the background subtraction</h2><pre class="codeinput"><span class="keyword">if</span> ~exist(<span class="string">'exp_data'</span>,<span class="string">'var'</span>)
</pre><h2 id="23">Import chamber background</h2><pre class="codeinput">    [twotheta,chamber_background_intensity] = import_xrdml_v2(Backgroundfile1,exp_anglestep);
    <span class="comment">%     [twotheta,chamber_background_intensity] = align_twotheta(twotheta,chamber_background_intensity,anglestart:exp_anglestep:exp_angleend,main_background_peak);</span>
    <span class="comment">%     [twotheta,chamber_background_intensity] = trans2braggbrentano(twotheta,chamber_background_intensity);</span>
</pre><h2 id="24">Import chamber background</h2><pre class="codeinput">    [twotheta,hk_background_intensity] = import_xrdml_v2(Backgroundfile2,exp_anglestep);
    <span class="comment">%     [twotheta,hk_background_intensity] = align_twotheta(twotheta,hk_background_intensity,anglestart:exp_anglestep:exp_angleend,main_background_peak);</span>
    <span class="comment">%     [twotheta,hk_background_intensity] = trans2braggbrentano(twotheta,hk_background_intensity);</span>
</pre><h2 id="25">Import sample data</h2><pre class="codeinput">    [twotheta,intensity] = import_xrdml_v2(filename,0.0334);
    figure
    hold <span class="string">on</span>
    plot(twotheta,intensity,<span class="string">'k'</span>);
    [twotheta,intensity] = align_twotheta(twotheta,intensity,anglestart:exp_anglestep:exp_angleend,align_angle);
    <span class="comment">%     [twotheta,intensity] = trans2braggbrentano(twotheta,intensity);</span>
    chamber_background_intensity=chamber_background_intensity*bckgrnd_factor1;
    hk_background_intensity=hk_background_intensity*bckgrnd_factor2;
    intensity=intensity-subtract_background*(chamber_background_intensity+hk_background_intensity);
</pre><h2 id="26">Plot the data</h2><pre class="codeinput">    hold <span class="string">on</span>
    plot(twotheta,intensity);
    <span class="keyword">if</span> subtract_background&gt;0
</pre><h2 id="27">Remove background</h2><pre class="codeinput">        [twotheta,newintensity] = remove_background(twotheta,intensity,bckgrnd_windowsize,bckgrnd_stepsize,exp_anglestep,bckgrnd_start);
<span class="comment">%         [twotheta,newintensity] = remove_background(twotheta,newintensity,bckgrnd_windowsize+5,bckgrnd_stepsize+5,exp_anglestep,bckgrnd_start);</span>
        newintensity=newintensity-min(newintensity);
        plot(twotheta,newintensity);
        plot(twotheta,intensity-newintensity);
</pre><pre class="codeinput">    <span class="keyword">else</span>
         newintensity=intensity;
    <span class="keyword">end</span>


    xlabel(<span class="string">'2Theta'</span>)
    ylabel(<span class="string">'Norm intensity'</span>)
    <span class="comment">%     plot(twotheta,oldintensity);</span>
    <span class="comment">%     plot(twotheta,chamber_background_intensity);</span>

    figure
    hold <span class="string">on</span>
    [~,exp_normstart_ind]=min(abs(twotheta-normstart));
    [~,exp_normend_ind]=min(abs(twotheta-normend));
    [max_I,max_I_index] = findpeaks(newintensity(1:exp_normend_ind),<span class="string">'SortStr'</span>,<span class="string">'descend'</span>,<span class="string">'NPeaks'</span>,1);
    [pks,locs] = findpeaks(newintensity/max_I,twotheta,<span class="string">'SortStr'</span>,<span class="string">'descend'</span>,<span class="string">'MinPeakDistance'</span>,1,<span class="string">'MinPeakProminence'</span>,0.05); <span class="comment">%</span>
    findpeaks(newintensity/max_I,twotheta,<span class="string">'SortStr'</span>,<span class="string">'descend'</span>,<span class="string">'MinPeakDistance'</span>,1,<span class="string">'MinPeakProminence'</span>,0.05); <span class="comment">%</span>
    rational_twotheta=[twotheta(max_I_index):twotheta(max_I_index):angleend];

    hold <span class="string">on</span>
    stem(rational_twotheta,repmat(1,numel(rational_twotheta),1),<span class="string">'LineStyle'</span>,<span class="string">'-'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'white'</span>,<span class="string">'MarkerEdgeColor'</span>,<span class="string">'white'</span>)
    text(rational_twotheta-1,repmat(1,numel(rational_twotheta),1)+.06,strtrim(strcat(<span class="string">'00'</span>,num2str((1:numel(rational_twotheta))',<span class="string">'%-d'</span>))))
    axis([anglestart angleend 0 1.2])

    plot([0,exp_angleend],[0 0],<span class="string">'k'</span>)
    xlabel(<span class="string">'2Theta'</span>)
    ylabel(<span class="string">'Norm intensity'</span>)
    <span class="comment">%     hold off</span>

    OneDXRD2C_gui
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018b</a><br></p></div><!--
##### SOURCE BEGIN #####
format compact;
%% Sample filename %%%%%%%%%
filename='Swy-2_3_60_FDS_1_16_glycol_manual_new.xrdml';
%% Background filename %%%%%
Backgroundfile1='CECslideglass.xrdml';
Backgroundfile2='MMT_hk.xrdml';
% Backgroundfile='Chamber_background_thin_kapton_foil_halftime.xrdml';
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Edit these values and inspect the background subtracted curve %%%%%%%
% main_background_peak=5.52; % Should be around 6.3 2theta for PSU
subtract_background=1;
bckgrnd_factor1=0; % Should be around 0.1 - 0.3
bckgrnd_factor2=0; %
bckgrnd_windowsize=5; % Try 3-5, see Matlabs msbackadj()
bckgrnd_stepsize=4; % Try 2-4 see Matlabs msbackadj()
bckgrnd_start=13; % Try 8-12, no background subtraction below this value
align_angle=26.18;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
HIGHN=30; % Max number of layers per stack, Will affect speed
%% Initial values %%%%%%%%%%
MaxIter=5; % lsqnonlin iterations
%% 2Theta settings %%%%%%%%%
lambda=1.541837;
anglestart=2; % Default 2
angleend=60; % Default 45
anglestep = 0.05; % Default 0.05
exp_angleend=60; % Default 45 or 50
exp_anglestep=0.0334; % Default 0.334
%% Fit range
fitstart=3.5; fitend=60;% Range for the residual in lsqnonlin
normstart=3;normend=11;% where will we find the 001 reflection for normalization
% exclude=[19.2 24   34 39 52 60]; % Exclude fitting between these values due to the hk0 reflections
exclude=[12 14 50 60]; % Exclude fitting between these values due to the hk0 reflections
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The interlayer counter-ion
% counterion='Na';
% ncounterion=0.66; % Used? per unit cell
%% Change G-factor number... 1 & 2 are the silicate layer, 3, 4, 5 are the
%% G's corresponding to the lower to higher basal spacings, like 0W, 1W, 2W or 1W, 2W, 3W etc.
ff='opls'
homogenous=0;
G_id=[4]; % 1,2 equals the silicate layers 3,4,5 stands for component 1,2 and 3
%% Optimize these atom types
Atom_labels_SIL=[];%{'Si' 'Obasal' 'Oapical' 'Oh' 'H'}; % Clay
% % Atom_labels_IL={'Cc1' 'Oc1' 'Hc1' 'Cc2' 'Oc2' 'Hc2'}; % Ow implicitly includes Hw
Atom_labels_IL={'Cc' 'Oc'};% 'Hc' 'Ca' 'Ow'}; % Ow implicitly includes Hw
Atom_labels=[Atom_labels_SIL Atom_labels_IL];% unique([structures.type])'; % all

%% Change G-factor with these fractions (* or /)
% %%    P  Z_shift  B
% Gmod=[1  0  1];
%%      1      2     3  ...
% %%    P      Z     B
%      [*      +-    *  ]; %repmat(Gmod./Gmod,1,numel(Atom_labels)) ];
x0G2_SIL = [1.0   0.00  1   ]; %repmat(Gmod./Gmod,1,numel(Atom_labels)) ];
lbG2_SIL = [1.0  -0.10  1   ];
ubG2_SIL = [1.0   0.10  1   ];
x0G2_IL  = [1.0   0.00  1   ]; %repmat(Gmod./Gmod,1,numel(Atom_labels)) ];
lbG2_IL  = [0.8  -0.20  1   ];
ubG2_IL  = [1.2   0.20  1   ];
%% To repeat the above values... in case of fitting many Atom types
x0G2=[repmat(x0G2_SIL,1,numel(Atom_labels_SIL)) repmat(x0G2_IL,1,numel(Atom_labels_IL))];
lbG2=[repmat(lbG2_SIL,1,numel(Atom_labels_SIL)) repmat(lbG2_IL,1,numel(Atom_labels_IL))];
ubG2=[repmat(ubG2_SIL,1,numel(Atom_labels_SIL)) repmat(ubG2_IL,1,numel(Atom_labels_IL))];
% x0G2=[repmat(x0G2_IL,1,numel(Atom_labels_IL))];
% lbG2=[repmat(lbG2_IL,1,numel(Atom_labels_IL))];
% ubG2=[repmat(ubG2_IL,1,numel(Atom_labels_IL))];
% x0G2=x0G2_IL;
% lbG2=lbG2_IL;
% ubG2=ubG2_IL;

%% Set basal spacings W0 W1 W2 W3 W4 and so on...
d001_0=13.9; % 0W % 10.9 for Cs...
d001_1=17; % 05W
d001_2=22; % 1W
d001_3=22; % 2W
d001_4=22; % 3W
d001_5=40; % 4W
deltaD=.2;

%% Gtransform_files %%%%%%%%
% lattice='Swy-2'; % Default 'Swy-2' lattice type
% interlayername='MX80'; % The interlayer type names
% Gtransform_files={strcat('G2_',lattice,'.mat') strcat('G2_',lattice,'.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_0W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_1W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_2W.mat')...
%     strcat('G2_',counterion,'_',lattice,'_',interlayername,'_3W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_4W.mat') strcat('G2_',counterion,'_',lattice,'_',interlayername,'_10W.mat')};
% 1W
%     strcat('../../G2_from_MD/WyCa_prevNa/G2md_swy-2_evap_222.mat')... strcat('../../G2_from_MD/WyCa/G2md_swy-2_evap_233.mat')...
Gtransform_files={...
    strcat('G2_scripts/G2_Swy-2_2-60.mat')...
    strcat('G2_scripts/G2_Swy-2_2-60.mat')...
    strcat('G2_scripts/G2md_Swy-2_',ff,'_1H2O_55.mat')...
    strcat('G2_scripts/G2md_Swy-2_',ff,'_1H2O_46.mat')...
    strcat('G2_scripts/G2md_Swy-2_opls_4H2O_39.mat')...
    strcat('G2_scripts/G2_Swy-2_glycol_Rey_16.9.mat')...
    strcat('../G2_from_MD/OPLS/16_CTA/G2md_Swy-2_opls_79.mat')...
    strcat('G2_scripts/G2_Swy-2_2-60.mat')...
    };
%    strcat('../G2_from_MD/OPLS/16_CTA/G2md_Swy-2_opls_79.mat')...
%    strcat('../G2_from_MD/OPLS/16_CTA/G2md_Swy-2_opls_79.mat')...
% strcat('../G2_from_MD/OPLS/4_CTA/G2md_Swy-2_opls_79.mat')...
%    strcat('../G2_from_MD/WyCa/G2md_swy-2_evap_179.mat')...
%    strcat('../G2_from_MD/WyCa/G2md_swy-2_evap_160.mat')...
%    strcat('../G2_from_MD/WyCa/G2md_swy-2_evap_140.mat')};
%    strcat('../../G2_from_MD/WyCa/G2_Swy-2_3W_FDb.mat')...
%    strcat('../G2_from_MD/G2md_swy-2_1W.mat')...
%     strcat('../G2_from_MD/G2_Swy-2_2-60.mat')...
%     strcat('../G2_from_MD/G2_Swy-2_2-60.mat')...
%     strcat('../G2_from_MD/G2_Swy-2_2-60.mat')...
% strcat('../G2_from_MD/OPLS/4_CTA/G2md_Swy-2_opls_79.mat')...
% strcat('../G2_from_MD/OPLS/4_CTA/G2md_Swy-2_opls_79.mat')...
%

%strcat('../G2_from_MD/OPLS/8_CTA/G2md_Swy-2_opls_80.mat')...

%% To run with Calcium MD data (you need to generate new G2's from WyCa
% predicted_d001=12.4;
% md_d001=load('d001.dat');
% md_d001(:,2)=10*md_d001(:,2);
% [~, ind_md_d001] = min(abs(md_d001(:,2)-predicted_d001));
% md_d001(ind_md_d001,1)
%% Default values for G2
P=1;
Z_shift=0;
B=1;
%% Custom variables
custom1=0; %
custom2=0; %
custom3=0; %
lb_custom1=0;
lb_custom2=0;
lb_custom3=0;
ub_custom1=0;
ub_custom2=2;
ub_custom3=0;

%%%%%%%%%%%%
%%

%% Do the background subtraction
if ~exist('exp_data','var')
    
    %% Import chamber background
    [twotheta,chamber_background_intensity] = import_xrdml_v2(Backgroundfile1,exp_anglestep);
    %     [twotheta,chamber_background_intensity] = align_twotheta(twotheta,chamber_background_intensity,anglestart:exp_anglestep:exp_angleend,main_background_peak);
    %     [twotheta,chamber_background_intensity] = trans2braggbrentano(twotheta,chamber_background_intensity);
    
    %% Import chamber background
    [twotheta,hk_background_intensity] = import_xrdml_v2(Backgroundfile2,exp_anglestep);
    %     [twotheta,hk_background_intensity] = align_twotheta(twotheta,hk_background_intensity,anglestart:exp_anglestep:exp_angleend,main_background_peak);
    %     [twotheta,hk_background_intensity] = trans2braggbrentano(twotheta,hk_background_intensity);
    
    %% Import sample data
    [twotheta,intensity] = import_xrdml_v2(filename,0.0334);
    figure
    hold on
    plot(twotheta,intensity,'k');
    [twotheta,intensity] = align_twotheta(twotheta,intensity,anglestart:exp_anglestep:exp_angleend,align_angle);
    %     [twotheta,intensity] = trans2braggbrentano(twotheta,intensity);
    chamber_background_intensity=chamber_background_intensity*bckgrnd_factor1;
    hk_background_intensity=hk_background_intensity*bckgrnd_factor2;
    intensity=intensity-subtract_background*(chamber_background_intensity+hk_background_intensity);
    
    %% Plot the data
    hold on
    plot(twotheta,intensity);
    if subtract_background>0
        %% Remove background
        [twotheta,newintensity] = remove_background(twotheta,intensity,bckgrnd_windowsize,bckgrnd_stepsize,exp_anglestep,bckgrnd_start);
%         [twotheta,newintensity] = remove_background(twotheta,newintensity,bckgrnd_windowsize+5,bckgrnd_stepsize+5,exp_anglestep,bckgrnd_start);
        newintensity=newintensity-min(newintensity);
        plot(twotheta,newintensity);
        plot(twotheta,intensity-newintensity);
    else
         newintensity=intensity;
    end
    
    
    xlabel('2Theta')
    ylabel('Norm intensity')
    %     plot(twotheta,oldintensity);
    %     plot(twotheta,chamber_background_intensity);
    
    figure
    hold on
    [~,exp_normstart_ind]=min(abs(twotheta-normstart));
    [~,exp_normend_ind]=min(abs(twotheta-normend));
    [max_I,max_I_index] = findpeaks(newintensity(1:exp_normend_ind),'SortStr','descend','NPeaks',1);
    [pks,locs] = findpeaks(newintensity/max_I,twotheta,'SortStr','descend','MinPeakDistance',1,'MinPeakProminence',0.05); %
    findpeaks(newintensity/max_I,twotheta,'SortStr','descend','MinPeakDistance',1,'MinPeakProminence',0.05); %
    rational_twotheta=[twotheta(max_I_index):twotheta(max_I_index):angleend];
    
    hold on
    stem(rational_twotheta,repmat(1,numel(rational_twotheta),1),'LineStyle','-','MarkerFaceColor','white','MarkerEdgeColor','white')
    text(rational_twotheta-1,repmat(1,numel(rational_twotheta),1)+.06,strtrim(strcat('00',num2str((1:numel(rational_twotheta))','%-d'))))
    axis([anglestart angleend 0 1.2])
    
    plot([0,exp_angleend],[0 0],'k')
    xlabel('2Theta')
    ylabel('Norm intensity')
    %     hold off
    
    OneDXRD2C_gui
    
end
%%


##### SOURCE END #####
--></body></html>